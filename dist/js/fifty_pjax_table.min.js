/*!
 * 50onRed - Fifty PJAX Table v0.2.0 ()
 * Copyright 2015
 * 
 */
!function(t,e){function n(e){function n(t,e){return{order:t+"__"+e,page:1}}function a(){t.pjax({url:F,data:L,push:D,container:A})}function r(){var e=t("#"+E),a=T.find(".ui-pagination");if(I){var r=a.data("current-page"),i=a.data("current-perpage");t.extend(L,{perpage:i}),t.extend(L,{page:r})}var o=e.data("current-sort-property"),c=e.data("current-sort-direction");o?t.extend(L,n(o,c)):delete L.order;var d=e.data("current-search-query");d&&t.extend(L,{q:d}),t.extend(L,e.data("custom-filters"))}function i(){K=t("#"+E).data("total-rows"),M=T.find("tbody");var e=k();K||M.html('<tr><td class="empty-table-content" colspan="'+e+"\">Whoops! Looks like there's nothing in this table!</td></tr>"),t.fn.tooltip&&T.find('[data-toggle="tooltip"]').tooltip()}function o(){var n=t('<div class="ui-load-mask">');T.css({position:"relative"}),T.append(n),n.spin(e.loadMaskConfig||"small")}function c(){T.find(".ui-load-mask").remove(),T.css({position:""})}function d(){function d(e,n){var a=M.find('td[data-value="'+n+'"]').parent(),r=M.find("tr"),i=r.index(e),o=r.index(a),c=Math.min(i,o),d=Math.max(i,o);i>o&&a.hasClass("ui-selected")?c+=1:d+=1,r.slice(c,d).each(function(){var e=t(this);a.hasClass("ui-selected")?e.addClass("ui-selected").children().first().find("input").prop("checked",!0):e.removeClass("ui-selected").children().first().find("input").prop("checked",!1)})}r(),i(),e.enableLoadMask&&(T.on("pjax:start",function(){o()}),T.on("pjax:beforeReplace",function(){c()}),T.on("pjax:error",function(){c()})),T.on("pjax:timeout",function(t){t.preventDefault()}),T.on("pjax:success",function(t){i(),t.stopPropagation(),T.trigger("load.table")}),T.on("pjax:error",function(t){t.stopPropagation()}),T.on("click",'th[data-sortable="true"]',function(e){var r=t(e.target).closest('th[data-sortable="true"]'),i=r.data("property"),o=z[r.data("current-sort-direction")]||r.data("default-sort-direction");T.trigger("sort.table",{direction:o,property:i}),t.extend(L,n(i,o)),a()}),T.on("click",".ui-perpage-dropdown > li",function(e){var n=t(e.currentTarget).data("value");T.trigger("perpage.table",{perpage:n}),t.extend(L,{perpage:n,page:1}),a()}),T.on("click",".ui-page-select-dropdown > li",function(e){var n=t(e.currentTarget).data("value");T.trigger("page.table",{page:n}),t.extend(L,{page:n}),a()}),T.on("click",".ui-prev-page",function(){var e=parseInt(T.find(".ui-pagination").data("current-page"));T.trigger("prevpage.table",{page:e-1}),t.extend(L,{page:e-1}),a()}),T.on("click",".ui-next-page",function(){var e=parseInt(T.find(".ui-pagination").data("current-page"));T.trigger("nextpage.table",{page:e+1}),t.extend(L,{page:e+1}),a()}),T.on("change",'th[data-select-all-enabled="true"] input[type="checkbox"]',function(){var e=t(this),n=e.parent("th").data("property");e.prop("checked")?(T.find("td[data-property="+n+'] input[type="checkbox"]').prop("checked",!0),M.find("tr").addClass("ui-selected"),T.trigger("select_all.table")):(T.find("td[data-property="+n+'] input[type="checkbox"]').prop("checked",!1),M.find("tr").removeClass("ui-selected"),T.trigger("deselect_all.table"))}),R.on("submit:search",function(e,n){T.trigger("search.table",{query:n}),t.extend(L,{q:n,page:1}),a()}),R.on("clear:search",function(){T.trigger("clear_search.table"),t.extend(L,{q:"",page:1}),a()}),T.on("click",'td[data-property="id"]',function(e){t(this).closest("tr").data("shiftKey",e.shiftKey)}),T.on("change",'input[type="checkbox"]',function(){var e=t(this),n=t(this).closest("tr"),a=y(n.get(0)),r=T.data("last_selected");r&&n.data("shiftKey")&&d(n,r),T.data("last_selected",a.id),e.prop("checked")?(n.addClass("ui-selected"),T.trigger("table.select",a)):(n.removeClass("ui-selected"),T.find('th[data-select-all-enabled="true"] input[type="checkbox"]').prop("checked",!1),T.trigger("table.deselect",a))}),u(),s()}function u(){e.plugins&&P(e.plugins)}function s(){var t,n;if(e.refreshEvents){t=e.refreshEvents.length;for(var a=0;t>a;a++)n=e.refreshEvents[a],n.filter?T.on(n.eventName,n.filter,function(){f()}):T.on(n.eventName,function(){f()})}}function l(t){return g(t),a(),N}function f(){return a(),N}function p(){return F}function g(t){for(var e in t)"undefined"==typeof t[e]||null===t[e]?delete L[e]:L[e]=t[e];return N}function h(e){if(!e)return N;if("string"==typeof e)delete L[e];else if(Array.isArray(e))for(var n=0;n<e.length;n++)delete L[e[n]];else{if("function"!=typeof e)throw new Error("Must provide a string or array");t.each(L,function(t,n){e(t,n)&&delete L[t]})}return N}function v(e){var n=t.extend({},L);return"function"==typeof e&&t.each(n,function(t,a){e(t,a)||delete n[t]}),n}function y(e){var n={additional_fields:{}};return t(e).children().each(function(){var e=t(this),a=e.data();n[a.property]=a.value,t.each(e.data(),function(t,e){"property"!==t&&"value"!==t&&"function"!=typeof e&&"object"!=typeof e&&(n.additional_fields[t]=e)})}),n}function m(t){return M.find("tr").filter(function(){return y(this).id===t?!0:!1}).get(0)}function x(e,n,a){var r,i,o=t(e);t.each(n,function(t,e){r=o.find('td[data-property="'+t+'"]'),r.data(t,e),i=r.data("format"),i&&(e=Q[i](e)),r.find(r.data("display-target")).text(e),"function"==typeof a&&a(r,t,e)})}function b(){return M.find("tr").length}function k(){return T.find("thead tr").children().length}function w(){return M.find("tr.ui-selected").length>0}function j(){return M.find("tr.ui-selected").length}function C(t){return M.find("tr.ui-selected").map(function(){return"function"==typeof t?t(y(this)):y(this)}).get()}function _(){return C().map(function(t){return t.id})}function $(){return M.find("tr").map(function(){return y(this)}).get()}function P(e){t.each(e,function(e,n){T.on("click",n.target,function(e){var a=t(e.currentTarget);a.data("plugin-initialized")||(a[n.constructorName](t.extend({},n.options,{queryState:t.extend({},L),record:y(a.closest("tr").get(0))})),a.data("plugin-initialized",!0))})})}function S(t,e,n){x(m(t),e,n)}function q(){return K}var N={},e=e||{},T=t(this),M=null,R=t("#"+(e.search_id||T.data("search-id"))),E=T.data("fifty-table-id"),F=T.data("pjax-url")||window.location.pathname,A=T.data("pjax-container"),D=T.data("push-state-enabled"),I=T.data("paginated"),K=null,z={asc:"desc",desc:"asc"},L={},Q={usd:function(t){return numeral(t).format("$0,0.00")},usd_thousandth:function(t){return numeral(t).format("$0,0.000")}};return d(),t.extend(N,{update:l,refresh:f,refreshPlugins:u,getUrl:p,updateParameters:g,removeParameters:h,getParameters:v,getNumRecords:b,getNumColumns:k,hasSelected:w,getNumSelected:j,getSelected:C,getSelectedIds:_,getAllRecords:$,applyPlugins:P,updateRow:S,getTotalRows:q}),N}e.widget("fiftyTable",n,!0)}(jQuery,window.Fifty=window.Fifty||{}),$(function(){$("[data-fifty-table][data-auto-init]").each(function(){$(this).fiftyTable({})})}),function(t,e){function n(){function e(){a.val(""),n.trigger("clear:search"),t(".ui-close").addClass("hidden")}var n=t(this),a=n.find('input[type="search"]');n.find(".ui-search").click(function(){n.trigger("submit:search",a.val())}),n.find(".ui-close").click(e),a.keydown(function(a){t(".ui-close").removeClass("hidden"),13===a.which?(a.preventDefault(),n.trigger("submit:search",t(this).val())):27==a.which&&(a.preventDefault(),e())})}e.widget("fiftySearch",n,!0)}(jQuery,window.Fifty=window.Fifty||{}),$(function(){$("[data-fifty-search][data-auto-init]").each(function(){$(this).fiftySearch()})});