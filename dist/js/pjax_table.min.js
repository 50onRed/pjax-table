/*!
 * 50onRed - PJAX Table v0.1.6 ()
 * Copyright 2015
 * 
 */
!function(t){"use strict";function e(e,i){this._options=i||{},this._$el=t(e),this._$tbody=null,this._ajaxOnly=this._options.ajaxOnly||this._$el.data("ajax-only")||!1,this._pushState=this._options.pushState||this._$el.data("push-state")||!0,this._paginated=this._options.paginated||this._$el.data("paginated")||!0,this._pjaxContainer=this._options.pjaxContainer||this._$el.data("pjax-container")||this._$el.attr("id"),this._noDataTemplate=this._options.noDataTemplate||this._noDataTemplate,this._createSortQuery=this._options.createSortQuery||this._createSortQuery,this._totalRows=null;var a=this._options.searchId||this._$el.data("search-id")||null;this._$searchBox=a?t(a):null,this._sortMap={asc:"desc",desc:"asc"},this._queryState={},this._init()}var i=Array.prototype.slice;t.extend(e.prototype,{_noDataTemplate:function(t){return["<tr>",'<td class="empty-table-content" colspan="'+t+'">',"Whoops! Looks like there's nothing in this table!","</td>","</tr>"].join("")},_createSortQuery:function(t,e){return{order:t+"__"+e,page:1}},_load:function(){return this._ajaxOnly?(this._addLoadMask(),t.ajax(t.extend({type:"GET",url:this._url,data:this._queryState,context:this},params)).done(this._onAjaxSucces).fail(this._onAjaxError)):t.pjax({url:this._url,data:this._queryState,push:this._pushState,container:this._pjaxContainer})},_addLoadMask:function(){var e=t('<div class="ui-load-mask">');this._$el.css({position:"relative"}),this._$el.append(e),e.spin(options.loadMaskConfig||"small")},_removeLoadMask:function(){this._$el.find(".ui-load-mask").remove(),this._$el.css({position:""})},_syncQueryState:function(){var e=this._$el.find("table"),i=this._$el.find(".ui-pagination");if(this._paginated){var a=i.data("current-page"),n=i.data("current-perpage");t.extend(this._queryState,{perpage:n}),t.extend(this._queryState,{page:a})}var s=e.data("current-sort-property"),r=e.data("current-sort-direction");s?t.extend(this._queryState,this._createSortQuery(s,r)):delete this._queryState.order;var o=e.data("current-search-query");o&&t.extend(this._queryState,{q:o}),t.extend(this._queryState,e.data("custom-filters"))},_onTableLoaded:function(){this._totalRows=this._$el.find("table").data("total-rows"),this._$tbody=this._$el.find("tbody");var t=this.getNumColumns();this._totalRows||this._$tbody.html(this._noDataTemplate(t)),this._$el.trigger("table:load")},_onAjaxSucces:function(t){this._$el.html(t),this._onTableLoaded(),this._removeLoadMask()},_onAjaxError:function(){this._removeLoadMask(),this._$el.trigger("table:error")},_onPjaxStart:function(){this._addLoadMask()},_onPjaxBeforeReplace:function(t){t.stopPropagation(),this._removeLoadMask()},_onPjaxTimeout:function(t){t.preventDefault(),this._$el.trigger("table:timeout")},_onPjaxSuccess:function(t){this._onTableLoaded(),t.stopPropagation()},_onPjaxError:function(t){t.stopPropagation(),this._removeLoadMask(),this._$el.trigger("table:error")},_onClickSortable:function(e){var i=t(e.target).closest('th[data-sortable="true"]'),a=i.data("property"),n=this._sortMap[i.data("current-sort-direction")]||i.data("default-sort-direction");this._$el.trigger("table:sort",{direction:n,property:a}),t.extend(this._queryState,this._createSortQuery(a,n)),this._load()},_onPerPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:perpage",{perpage:i}),t.extend(this._queryState,{perpage:i,page:1}),this._load()},_onPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:page",{page:i}),t.extend(this._queryState,{page:i}),this._load()},_onPrevPageSelect:function(){var e=parseInt($el.find(".ui-pagination").data("current-page"));this._$el.trigger("table:prevpage",{page:e-1}),t.extend(this._queryState,{page:e-1}),this._load()},_onNextPageSelect:function(){var e=parseInt($el.find(".ui-pagination").data("current-page"));this._$el.trigger("table:nextpage",{page:e+1}),t.extend(this._queryState,{page:e+1}),this._load()},_onRowCheckboxSelect:function(){var e=t(this),i=e.parent("th").data("property");e.prop("checked")?(this._$el.find("td[data-property="+i+'] input[type="checkbox"]').prop("checked",!0),this._$tbody.find("tr").addClass("ui-selected"),this._$el.trigger("select_all:table")):(this._$el.find("td[data-property="+i+'] input[type="checkbox"]').prop("checked",!1),this._$tbody.find("tr").removeClass("ui-selected"),this._$el.trigger("deselect_all:table"))},_onClickIdColumn:function(e){t(this).closest("tr").data("shiftKey",e.shiftKey)},_onRowCheckboxChange:function(){var e=t(this),i=t(this).closest("tr"),a=getRecord(i.get(0)),n=this._$el.data("last_selected");n&&i.data("shiftKey")&&this._shiftSelectRows(i,n),this._$el.data("last_selected",a.id),e.prop("checked")?(i.addClass("ui-selected"),this._$el.trigger("table:select",a)):(i.removeClass("ui-selected"),this._$el.find('th[data-select-all-enabled="true"] input[type="checkbox"]').prop("checked",!1),this._$el.trigger("table:deselect",a))},_shiftSelectRows:function(e,i){var a=this._$tbody.find('td[data-value="'+i+'"]').parent(),n=this._$tbody.find("tr"),s=n.index(e),r=n.index(a),o=Math.min(s,r),h=Math.max(s,r);s>r&&a.hasClass("ui-selected")?o+=1:h+=1,n.slice(o,h).each(function(){var e=t(this);a.hasClass("ui-selected")?e.addClass("ui-selected").children().first().find("input").prop("checked",!0):e.removeClass("ui-selected").children().first().find("input").prop("checked",!1)})},_onSubmitSearch:function(e,i){this._$el.trigger("table:search",{query:i}),t.extend(this._queryState,{q:i,page:1}),this._load()},_onClearSearch:function(){this._$el.trigger("table:search:clear"),t.extend(this._queryState,{q:"",page:1}),this._load()},_applyPlugins:function(e){t.each(e,function(e,i){this._$el.on("click",i.target,function(e){var a=t(e.currentTarget);a.data("plugin-initialized")||(a[i.constructorName](t.extend({},i.options,{queryState:t.extend({},this._queryState),record:this._getRecord(a.closest("tr").get(0))})),a.data("plugin-initialized",!0))}.bind(this))}.bind(this))},_onPluginRefreshEvent:function(){this.refresh()},_initPluginRefreshEvents:function(){var t,e;if(this._options.refreshEvents){t=this._options.refreshEvents.length;for(var i=0;t>i;i++)e=options.refreshEvents[i],e.filter?this._$el.on(e.eventName,e.filter,this._onPluginRefreshEvent.bind(this)):this._$el.on(e.eventName,this._onPluginRefreshEvent.bind(this))}},_init:function(){this._syncQueryState(),this._onTableLoaded(),this._$el.on("pjax:timeout",this._onPjaxTimeout.bind(this)),this._$el.on("pjax:success",this._onPjaxSuccess.bind(this)),this._$el.on("pjax:start",this._onPjaxStart.bind(this)),this._$el.on("pjax:beforeReplace",this._onPjaxBeforeReplace.bind(this)),this._$el.on("pjax:error",this._onPjaxError.bind(this)),this._$el.on("click",'th[data-sortable="true"]',this._onClickSortable.bind(this)),this._$el.on("click",".ui-perpage-dropdown > li",this._onPerPageSelect.bind(this)),this._$el.on("click",".ui-page-select-dropdown > li",this._onPageSelect.bind(this)),this._$el.on("click",".ui-prev-page",this._onPrevPageSelect.bind(this)),this._$el.on("click",".ui-next-page",this._onNextPageSelect.bind(this)),this._$el.on("change",'th[data-select-all-enabled="true"] input[type="checkbox"]',this._onRowCheckboxSelect.bind(this)),this._$el.on("click",'td[data-property="id"]',this._onClickIdColumn.bind(this)),this._$el.on("change",'input[type="checkbox"]',this._onRowCheckboxChange.bind(this)),this._$searchBox&&(this._$searchBox.on("search:submit",this._onSubmitSearch.bind(this)),this._$searchBox.on("search:clear",this._onClearSearch.bind(this))),this.refreshPlugins(),this._initPluginRefreshEvents()},_getRecord:function(e){var i={additionalFields:{}};return t(e).children().each(function(){var e=t(this),a=e.data();i[a.property]=a.value,t.each(e.data(),function(t,e){"property"!==t&&"value"!==t&&"function"!=typeof e&&"object"!=typeof e&&(i.additionalFields[t]=e)})}),i},_findRowById:function(t){return this._$tbody.find("tr").filter(function(){return this._getRecord(this).id===t?!0:!1}.bind(this)).get(0)},_updateRowFields:function(e,i,a){var n=t(e);t.each(i,function(t,e){var i=n.find('td[data-property="'+t+'"]');i.data(t,e),i.find(i.data("display-target")).text(e),"function"==typeof a&&a(i,t,e)})},refreshPlugins:function(){this._options.plugins&&this._applyPlugins(this._options.plugins)},update:function(t){return this.updateParameters(t),this._load(),this},refresh:function(){return this._load(),this},getUrl:function(){return this._url},updateParameters:function(t){for(var e in t)"undefined"==typeof t[e]||null===t[e]?delete this._queryState[e]:this._queryState[e]=t[e];return this},removeParameters:function(e){if(!e)return this;if("string"==typeof e)delete this._queryState[e];else if(Array.isArray(e))for(var i=0;i<e.length;i++)delete this._queryState[e[i]];else{if("function"!=typeof e)throw new Error("Must provide a string or array");t.each(this._queryState,function(t,i){e(t,i)&&delete this._queryState[t]}.bind(this))}return this},getParameters:function(e){var i=t.extend({},this._queryState);return"function"==typeof e&&t.each(i,function(t,a){e(t,a)||delete i[t]}),i},getNumRecords:function(){return this._$tbody.find("tr").length},getNumColumns:function(){return this._$el.find("thead tr").children().length},hasSelected:function(){return this._$tbody.find("tr.ui-selected").length>0},getNumSelected:function(){return this._$tbody.find("tr.ui-selected").length},getSelected:function(t){return this._$tbody.find("tr.ui-selected").map(function(){return"function"==typeof t?t(this._getRecord(this)):this._getRecord(this)}.bind(this)).get()},getSelectedIds:function(){return this.getSelected().map(function(t){return t.id})},getAllRecords:function(){return this._$tbody.find("tr").map(function(){return this._getRecord(this)}.bind(this)).get()},updateRow:function(t,e,i){this._updateRowFields(this._findRowById(t),e,i)},getTotalRows:function(){return this._totalRows}}),t.fn.pjaxTable=function(a){var n=i.call(arguments),s=["update","refresh","refreshPlugins","getUrl","updateParameters","removeParameters","getParameters","getNumRecords","getNumColumns","hasSelected","getNumSelected","getSelected","getSelectedIds","getAllRecords","updateRow","getTotalRows"],r=[];return t(this).each(function(){var i,o=t(this),h=o.data("pjaxTable");if(h||(h=o.data("pjaxTable",new e(this,a)).data("pjaxTable")),"string"==typeof a&&h)if("destroy"===a)"function"==typeof h.destroy&&h.destroy(),delete o.data()[finalName],o=null;else{if(-1===indexOf(a,s))throw new Error("Invalid method: "+a);i=h[a].apply(this,n.slice(1,n.length)),r.push(i)}else r.push(h)}),r.length>1?r:1===r.length?r[0]:void 0},t(function(){t("[data-pjax-table][data-auto-init]").pjaxTable({})})}(jQuery,window),function(t){"use strict";function e(){this._$el=t(this),this._$searchFilter=$el.find('input[type="search"]'),this._init()}var i=Array.prototype.slice;e.prototype._init=function(){this._$el.find(".ui-search").click(this._onClickSearch.bind(this)),this._$el.find(".ui-close").click(this._onClickClose.bind(this)),this._$searchFilter.keydown(this._onInputKeydown.bind(this))},e.prototype._onClickSearch=function(){this._$el.trigger("search:submit",$searchFilter.val())},e.prototype._onInputKeydown=function(e){e.preventDefault(),this._$el.find(".ui-close").removeClass("hidden"),13===e.which?this._$el.trigger("search:submit",t(e.currentTarget).val()):27==e.which&&this._clearSearch()},e.prototype._onClickClose=function(){this._clearSearch()},e.prototype._clearSearch=function(){this._$searchFilter.val(""),this._$el.trigger("search:clear"),this._$el.find(".ui-close").addClass("hidden")},t.fn.pjaxTableSearch=function(a){var n=(i.call(arguments),[]);return t(this).each(function(){var i=t(this),s=i.data("pjaxTableSearch");s||(s=i.data("pjaxTableSearch",new e(this,a)).data("pjaxTableSearch")),"string"==typeof a&&s?"destroy"===a&&("function"==typeof s.destroy&&s.destroy(),delete i.data()[finalName],i=null):n.push(s)}),n.length>1?n:1===n.length?n[0]:void 0},t("[data-pjax-table-search][data-auto-init]").pjaxTableSearch({})}(jQuery);