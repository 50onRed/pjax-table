/*!
 * 50onRed - PJAX Table v1.0.4 ()
 * Copyright 2015
 * 
 */
!function(t,e,i){"use strict";function a(a,n){this._options=n||{},this._$el=t(a),this._$tbody=null,this._url=this._options.url||this._$el.data("url")||e.location.href,this._ajaxOnly=this._options.ajaxOnly!==i?this._options.ajaxOnly:this._$el.data("ajax-only")||!1,this._pushState=this._options.pushState!==i?this._options.pushState:this._$el.data("push-state")||!0,this._paginated=this._options.paginated!==i?this._options.paginated:this._$el.data("paginated")||!0,this._pjaxContainer=this._options.pjaxContainer||this._$el.data("pjax-container")||this._$el.attr("id"),this._noDataTemplate=this._options.noDataTemplate||this._noDataTemplate,this._sortQueryKey=this._options.sortQueryKey||this._$el.data("sort-query-key")||"order",this._pageQueryKey=this._options.pageQueryKey||this._$el.data("page-query-key")||"page",this._perPageQueryKey=this._options.perPageQueryKey||this._$el.data("perpage-query-key")||"perpage",this._searchQueryKey=this._options.searchQueryKey||this._$el.data("search-query-key")||"q",this._totalRows=null;var s=this._options.searchId||this._$el.data("search-id")||null;this._$searchBox=s?t(s):null,this._sortMap={asc:"desc",desc:"asc"},this._queryState={},this._init()}var n=Array.prototype.slice;t.extend(a.prototype,{_noDataTemplate:function(t){return["<tr>",'<td class="empty-table-content" colspan="'+t+'">',"Whoops! Looks like there's nothing in this table!","</td>","</tr>"].join("")},_createSortQuery:function(t,e){var i={};return i[this._sortQueryKey]=t+"__"+e,i},_desyncSort:function(){delete this._queryState[this._sortQueryKey]},_createPageQuery:function(t){var e={};return e[this._pageQueryKey]=t,e},_createPerPageQuery:function(t){var e={};return e[this._perPageQueryKey]=t,e},_createSearchQuery:function(t){var e={};return e[this._searchQueryKey]=t,e},_desyncSearch:function(){delete this._queryState[this._searchQueryKey]},_syncSort:function(e,i){t.extend(this._queryState,this._createSortQuery(e,i))},_syncPage:function(e){t.extend(this._queryState,this._createPageQuery(e))},_syncPerPage:function(e){t.extend(this._queryState,this._createPerPageQuery(e))},_syncSearch:function(e){t.extend(this._queryState,this._createSearchQuery(e))},_load:function(){return this._ajaxOnly?(this._addLoadMask(),t.ajax({type:"GET",url:this._url,data:this._queryState,context:this}).done(this._onAjaxSuccess).fail(this._onAjaxError)):t.pjax({url:this._url,data:this._queryState,push:this._pushState,container:this._pjaxContainer})},_addLoadMask:function(){var e=t('<div class="ui-load-mask">');this._$el.css({position:"relative"}),this._$el.append(e),e.spin(this._options.loadMaskConfig||"small")},_removeLoadMask:function(){this._$el.find(".ui-load-mask").remove(),this._$el.css({position:""})},_syncQueryState:function(){var t=this._$el.find("table"),e=this._$el.find(".ui-pagination"),i=e.data("current-page"),a=e.data("current-perpage"),n=t.data("current-sort-property"),s=t.data("current-sort-direction"),r=t.data("current-search-str");this._paginated&&(this._syncPage(i),this._syncPerPage(a)),n?this._syncSort(n,s):this._desyncSort(),r?this._syncSearch(r):this._desyncSearch()},_onTableLoaded:function(){this._$tbody=this._$el.find("tbody");var t=this._$el.find("table").data("total-rows");this._totalRows=0|t,0===this._totalRows&&this._$tbody.html(this._noDataTemplate(this.getNumColumns())),this._$el.trigger("table:load")},_onAjaxSuccess:function(t){this._$el.html(t),this._onTableLoaded(),this._removeLoadMask()},_onAjaxError:function(){this._removeLoadMask(),this._$el.trigger("table:error")},_onPjaxStart:function(){this._addLoadMask()},_onPjaxBeforeReplace:function(t){t.stopPropagation(),this._removeLoadMask()},_onPjaxTimeout:function(t){t.preventDefault(),this._$el.trigger("table:timeout")},_onPjaxSuccess:function(t){this._onTableLoaded(),t.stopPropagation()},_onPjaxError:function(t){t.stopPropagation(),this._removeLoadMask(),this._$el.trigger("table:error")},_onClickSortable:function(e){var i=t(e.target).closest('th[data-sortable="true"]'),a=i.data("property"),n=this._sortMap[i.data("current-sort-direction")]||i.data("default-sort-direction");this._$el.trigger("table:sort",this._createSortQuery(a,n)),this._syncSort(a,n),this._load()},_onPerPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:perpage",this._createPerPageQuery(i)),this._syncPerPage(i),this._syncPage(1),this._load()},_onPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:page",this._createPageQuery(i)),this._syncPage(i),this._load()},_onPrevPageSelect:function(){var t=parseInt(this._$el.find(".ui-pagination").data("current-page")),e=Math.max(1,t-1);this._$el.trigger("table:prevpage",this._createPageQuery(e)),this._syncPage(e),this._load()},_onNextPageSelect:function(){var t=parseInt(this._$el.find(".ui-pagination").data("current-page")),e=t+1;this._$el.trigger("table:nextpage",this._createPageQuery(e)),this._syncPage(e),this._load()},_onHeaderCheckboxChange:function(e){var i=t(e.currentTarget),a=i.parent("th").data("property");this._disableRowCheckboxChangeHandling(),i.prop("checked")?(this._$el.find("td[data-property="+a+'] input[type="checkbox"]').prop("checked",!0),this._$tbody.find("tr").addClass("ui-selected"),this._$el.trigger("table:select:all")):(this._$el.find("td[data-property="+a+'] input[type="checkbox"]').prop("checked",!1),this._$tbody.find("tr").removeClass("ui-selected"),this._$el.trigger("table:deselect:all")),this._enableRowCheckboxChangeHandling()},_onClickIdColumn:function(e){t(this).closest("tr").data("shiftKey",e.shiftKey)},_onRowCheckboxChange:function(e){var i=t(e.currentTarget),a=t(e.currentTarget).closest("tr"),n=this._getRecord(a.get(0)),s=this._$el.data("last_selected");s&&a.data("shiftKey")&&(this._disableRowCheckboxChangeHandling(),this._shiftSelectRows(a,s),this._enableRowCheckboxChangeHandling()),this._$el.data("last_selected",n.id),i.prop("checked")?(a.addClass("ui-selected"),this._$el.trigger("table:select",n)):(a.removeClass("ui-selected"),this._$el.find('th[data-select-all-enabled="true"] input[type="checkbox"]').prop("checked",!1),this._$el.trigger("table:deselect",n))},_shiftSelectRows:function(e,i){var a=this._$tbody.find('td[data-property="id"][data-value="'+i+'"]').parent(),n=this._$tbody.find("tr"),s=n.index(e),r=n.index(a),o=Math.min(s,r),h=Math.max(s,r);s>r&&a.hasClass("ui-selected")&&++o,++h,n.slice(o,h).each(function(){var e=t(this);a.hasClass("ui-selected")?e.addClass("ui-selected").children().first().find("input").prop("checked",!0):e.removeClass("ui-selected").children().first().find("input").prop("checked",!1)}),this._$el.trigger("table:shiftselect")},_onSubmitSearch:function(t,e){this._$el.trigger("table:search",this._createSearchQuery(e)),this._syncSearch(e),this._syncPage(1),this._load()},_onClearSearch:function(){this._$el.trigger("table:search:clear"),this._desyncSearch(),this._syncPage(1),this._load()},_applyPlugins:function(e){t.each(e,function(e,i){this._$el.on("click",i.target,function(e){var a=t(e.currentTarget);a.data("plugin-initialized")||(a[i.constructorName](t.extend({},i.options,{queryState:t.extend({},this._queryState),record:this._getRecord(a.closest("tr").get(0))})),a.data("plugin-initialized",!0))}.bind(this))}.bind(this))},_onPluginRefreshEvent:function(){this.refresh()},_initPluginRefreshEvents:function(){var t,e;if(this._options.refreshEvents){t=this._options.refreshEvents.length;for(var i=0;t>i;i++)e=options.refreshEvents[i],e.filter?this._$el.on(e.eventName,e.filter,this._onPluginRefreshEvent.bind(this)):this._$el.on(e.eventName,this._onPluginRefreshEvent.bind(this))}},_enableRowCheckboxChangeHandling:function(){this._checkboxChangeHandler=this._onRowCheckboxChange.bind(this),this._$el.on("change",'td[data-property="id"] input[type="checkbox"]',this._checkboxChangeHandler)},_disableRowCheckboxChangeHandling:function(){this._$el.off("change",'td[data-property="id"] input[type="checkbox"]',this._checkboxChangeHandler),this._checkboxChangeHandler=null},_init:function(){this._syncQueryState(),this._onTableLoaded(),this._$el.on("pjax:timeout",this._onPjaxTimeout.bind(this)),this._$el.on("pjax:success",this._onPjaxSuccess.bind(this)),this._$el.on("pjax:start",this._onPjaxStart.bind(this)),this._$el.on("pjax:beforeReplace",this._onPjaxBeforeReplace.bind(this)),this._$el.on("pjax:error",this._onPjaxError.bind(this)),this._$el.on("click",'th[data-sortable="true"]',this._onClickSortable.bind(this)),this._$el.on("click",".ui-perpage-dropdown > li",this._onPerPageSelect.bind(this)),this._$el.on("click",".ui-page-select-dropdown > li",this._onPageSelect.bind(this)),this._$el.on("click",".ui-prev-page",this._onPrevPageSelect.bind(this)),this._$el.on("click",".ui-next-page",this._onNextPageSelect.bind(this)),this._$el.on("change",'th[data-select-all-enabled="true"] input[type="checkbox"]',this._onHeaderCheckboxChange.bind(this)),this._enableRowCheckboxChangeHandling(),this._$el.on("click",'td[data-property="id"]',this._onClickIdColumn.bind(this)),this._$searchBox&&(this._$searchBox.on("search:submit",this._onSubmitSearch.bind(this)),this._$searchBox.on("search:clear",this._onClearSearch.bind(this))),this.refreshPlugins(),this._initPluginRefreshEvents()},_getRecord:function(e){var i={additionalFields:{}};return t(e).children().each(function(){var e=t(this),a=e.data();i[a.property]=a.value,t.each(e.data(),function(t,e){"property"!==t&&"value"!==t&&"function"!=typeof e&&"object"!=typeof e&&(i.additionalFields[t]=e)})}),i},_findRowById:function(t){return this._$tbody.find("tr").filter(function(e,i){return this._getRecord(i).id===t?!0:!1}.bind(this)).get(0)},_updateRowFields:function(e,i,a){var n=t(e);t.each(i,function(t,e){var i=n.find('td[data-property="'+t+'"]');i.data("value",e),i.find(i.data("display-target")).text(e),"function"==typeof a&&a(i,t,e)})},refreshPlugins:function(){this._options.plugins&&this._applyPlugins(this._options.plugins)},update:function(t){return this.updateParameters(t),this._load(),this},refresh:function(){return this._load(),this},getUrl:function(){return this._url},updateParameters:function(t){for(var e in t)"undefined"==typeof t[e]||null===t[e]?delete this._queryState[e]:this._queryState[e]=t[e];return this},removeParameters:function(e){if(!e||Array.isArray(e)&&!e.length)return this;if("string"==typeof e)delete this._queryState[e];else if(Array.isArray(e))for(var i=0;i<e.length;i++)delete this._queryState[e[i]];else"function"==typeof e&&t.each(this._queryState,function(t,i){e(t,i)&&delete this._queryState[t]}.bind(this));return this},getParameters:function(e){var i=t.extend({},this._queryState);return"function"==typeof e&&t.each(i,function(t,a){e(t,a)||delete i[t]}),i},getNumRecords:function(){return this._$tbody.find("tr").length},getNumColumns:function(){return this._$el.find("thead tr").children().length},hasSelectedRecords:function(){return this._$tbody.find("tr.ui-selected").length>0},getNumSelectedRecords:function(){return this._$tbody.find("tr.ui-selected").length},getSelectedRecords:function(t){return this._$tbody.find("tr.ui-selected").map(function(e,i){return"function"==typeof t?t(this._getRecord(i)):this._getRecord(i)}.bind(this)).get()},getSelectedRecordIds:function(){return this.getSelectedRecords(function(t){return t.id})},getRecords:function(){return this._$tbody.find("tr").map(function(t,e){return this._getRecord(e)}.bind(this)).get()},updateRow:function(t,e,i){this._updateRowFields(this._findRowById(t),e,i)},getNumTotalRows:function(){return this._totalRows}}),t.fn.pjaxTable=function(e){var i=n.call(arguments),s=[];return t(this).each(function(){var n,r=t(this),o=r.data("pjaxTable");if(o||(o=r.data("pjaxTable",new a(this,e)).data("pjaxTable")),"string"==typeof e)if("destroy"===e)"function"==typeof o.destroy&&o.destroy(),delete r.data().pjaxTable;else{if("function"!=typeof o[e]||"_"===e.charAt(0))throw new Error("Invalid method: "+e);n=o[e].apply(o,i.slice(1,i.length)),s.push(n)}else s.push(o)}),s.length>1?s:s[0]},t(function(){t("[data-pjax-table][data-auto-init]").pjaxTable({})})}(jQuery,window,void 0),function(t){"use strict";function e(){this._$el=t(this),this._$searchFilter=$el.find('input[type="search"]'),this._init()}var i=Array.prototype.slice;e.prototype._init=function(){this._$el.find(".ui-search").click(this._onClickSearch.bind(this)),this._$el.find(".ui-close").click(this._onClickClose.bind(this)),this._$searchFilter.keydown(this._onInputKeydown.bind(this))},e.prototype._onClickSearch=function(){this._$el.trigger("search:submit",$searchFilter.val())},e.prototype._onInputKeydown=function(e){e.preventDefault(),this._$el.find(".ui-close").removeClass("hidden"),13===e.which?this._$el.trigger("search:submit",t(e.currentTarget).val()):27==e.which&&this._clearSearch()},e.prototype._onClickClose=function(){this._clearSearch()},e.prototype._clearSearch=function(){this._$searchFilter.val(""),this._$el.trigger("search:clear"),this._$el.find(".ui-close").addClass("hidden")},t.fn.pjaxTableSearch=function(a){var n=(i.call(arguments),[]);return t(this).each(function(){var i=t(this),s=i.data("pjaxTableSearch");s||(s=i.data("pjaxTableSearch",new e(this,a)).data("pjaxTableSearch")),"string"==typeof a&&s?"destroy"===a&&("function"==typeof s.destroy&&s.destroy(),delete i.data()[finalName],i=null):n.push(s)}),n.length>1?n:1===n.length?n[0]:void 0},t(function(){t("[data-pjax-table-search][data-auto-init]").pjaxTableSearch({})})}(jQuery);