/*!
 * 50onRed - PJAX Table v0.2.0 ()
 * Copyright 2015
 * 
 */
!function(t,e){"use strict";function i(i,a){this._options=a||{},this._$el=t(i),this._$tbody=null,this._url=this._options.url||this._$el.data("url")||e.location.href,this._ajaxOnly=this._options.ajaxOnly||this._$el.data("ajax-only")||!1,this._pushState=this._options.pushState||this._$el.data("push-state")||!0,this._paginated=this._options.paginated||this._$el.data("paginated")||!0,this._pjaxContainer=this._options.pjaxContainer||this._$el.data("pjax-container")||this._$el.attr("id"),this._noDataTemplate=this._options.noDataTemplate||this._noDataTemplate,this._sortQueryKey=this._options.sortQueryKey||this._$el.data("sort-query-key")||"order",this._pageQueryKey=this._options.pageQueryKey||this._$el.data("page-query-key")||"page",this._perPageQueryKey=this._options.perPageQueryKey||this._$el.data("perpage-query-key")||"perpage",this._searchQueryKey=this._options.searchQueryKey||this._$el.data("search-query-key")||"q",this._totalRows=null;var s=this._options.searchId||this._$el.data("search-id")||null;this._$searchBox=s?t(s):null,this._sortMap={asc:"desc",desc:"asc"},this._queryState={},this._init()}var a=Array.prototype.slice;t.extend(i.prototype,{_noDataTemplate:function(t){return["<tr>",'<td class="empty-table-content" colspan="'+t+'">',"Whoops! Looks like there's nothing in this table!","</td>","</tr>"].join("")},_createSortQuery:function(t,e){var i={};return i[this._sortQueryKey]=t+"__"+e,i},_desyncSort:function(){delete this._queryState[this._sortQueryKey]},_createPageQuery:function(t){var e={};return e[this._pageQueryKey]=t,e},_createPerPageQuery:function(t){var e={};return e[this._perPageQueryKey]=t,e},_createSearchQuery:function(t){var e={};return e[this._searchQueryKey]=t,e},_desyncSearch:function(){delete this._queryState[this._searchQueryKey]},_syncSort:function(e,i){t.extend(this._queryState,this._createSortQuery(e,i))},_syncPage:function(e){t.extend(this._queryState,this._createPageQuery(e))},_syncPerPage:function(e){t.extend(this._queryState,this._createPerPageQuery(e))},_syncSearch:function(e){t.extend(this._queryState,this._createSearchQuery(e))},_load:function(){return this._ajaxOnly?(this._addLoadMask(),t.ajax(t.extend({type:"GET",url:this._url,data:this._queryState,context:this},params)).done(this._onAjaxSucces).fail(this._onAjaxError)):t.pjax({url:this._url,data:this._queryState,push:this._pushState,container:this._pjaxContainer})},_addLoadMask:function(){var e=t('<div class="ui-load-mask">');this._$el.css({position:"relative"}),this._$el.append(e),e.spin(options.loadMaskConfig||"small")},_removeLoadMask:function(){this._$el.find(".ui-load-mask").remove(),this._$el.css({position:""})},_syncQueryState:function(){var t=this._$el.find("table"),e=this._$el.find(".ui-pagination"),i=e.data("current-page"),a=e.data("current-perpage"),s=t.data("current-sort-property"),n=t.data("current-sort-order"),r=t.data("current-search-str");this._paginated&&(this._syncPage(i),this._syncPerPage(a)),s?this._syncSort(s,n):this._desyncSort(),searchQuery?this._syncSearch(r):this._desyncSearch()},_onTableLoaded:function(){this._$tbody=this._$el.find("tbody");var t=this._$el.find("table").data("total-rows");this._totalRows=isNaN(t)?0:parseInt(t),0===this._totalRows&&this._$tbody.html(this._noDataTemplate(this.getNumColumns())),this._$el.trigger("table:load")},_onAjaxSucces:function(t){this._$el.html(t),this._onTableLoaded(),this._removeLoadMask()},_onAjaxError:function(){this._removeLoadMask(),this._$el.trigger("table:error")},_onPjaxStart:function(){this._addLoadMask()},_onPjaxBeforeReplace:function(t){t.stopPropagation(),this._removeLoadMask()},_onPjaxTimeout:function(t){t.preventDefault(),this._$el.trigger("table:timeout")},_onPjaxSuccess:function(t){this._onTableLoaded(),t.stopPropagation()},_onPjaxError:function(t){t.stopPropagation(),this._removeLoadMask(),this._$el.trigger("table:error")},_onClickSortable:function(e){var i=t(e.target).closest('th[data-sortable="true"]'),a=i.data("property"),s=this._sortMap[i.data("current-sort-order")]||i.data("default-sort-order");this._$el.trigger("table:sort",this._createSortQuery(a,s)),this._syncSort(a,s),this._load()},_onPerPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:perpage",this._createPerPageQuery(i)),this._syncPerPage(i),this._syncPage(1),this._load()},_onPageSelect:function(e){var i=t(e.currentTarget).data("value");this._$el.trigger("table:page",this._createPageQuery(i)),this._syncPage(i),this._load()},_onPrevPageSelect:function(){var t=parseInt($el.find(".ui-pagination").data("current-page")),e=t-1;this._$el.trigger("table:prevpage",this._createPageQuery(e)),this._syncPage(e),this._load()},_onNextPageSelect:function(){var t=parseInt($el.find(".ui-pagination").data("current-page")),e=t+1;this._$el.trigger("table:nextpage",this._createPageQuery(e)),this._syncPage(e),this._load()},_onRowCheckboxSelect:function(){var e=t(this),i=e.parent("th").data("property");e.prop("checked")?(this._$el.find("td[data-property="+i+'] input[type="checkbox"]').prop("checked",!0),this._$tbody.find("tr").addClass("ui-selected"),this._$el.trigger("select_all:table")):(this._$el.find("td[data-property="+i+'] input[type="checkbox"]').prop("checked",!1),this._$tbody.find("tr").removeClass("ui-selected"),this._$el.trigger("deselect_all:table"))},_onClickIdColumn:function(e){t(this).closest("tr").data("shiftKey",e.shiftKey)},_onRowCheckboxChange:function(){var e=t(this),i=t(this).closest("tr"),a=getRecord(i.get(0)),s=this._$el.data("last_selected");s&&i.data("shiftKey")&&this._shiftSelectRows(i,s),this._$el.data("last_selected",a.id),e.prop("checked")?(i.addClass("ui-selected"),this._$el.trigger("table:select",a)):(i.removeClass("ui-selected"),this._$el.find('th[data-select-all-enabled="true"] input[type="checkbox"]').prop("checked",!1),this._$el.trigger("table:deselect",a))},_shiftSelectRows:function(e,i){var a=this._$tbody.find('td[data-value="'+i+'"]').parent(),s=this._$tbody.find("tr"),n=s.index(e),r=s.index(a),o=Math.min(n,r),h=Math.max(n,r);n>r&&a.hasClass("ui-selected")?++o:++h,s.slice(o,h).each(function(){var e=t(this);a.hasClass("ui-selected")?e.addClass("ui-selected").children().first().find("input").prop("checked",!0):e.removeClass("ui-selected").children().first().find("input").prop("checked",!1)})},_onSubmitSearch:function(t,e){this._$el.trigger("table:search",this._createSearchQuery(e)),this._syncSearch(e),this._syncPage(1),this._load()},_onClearSearch:function(){this._$el.trigger("table:search:clear"),this._desyncSearch(),this._syncPage(1),this._load()},_applyPlugins:function(e){t.each(e,function(e,i){this._$el.on("click",i.target,function(e){var a=t(e.currentTarget);a.data("plugin-initialized")||(a[i.constructorName](t.extend({},i.options,{queryState:t.extend({},this._queryState),record:this._getRecord(a.closest("tr").get(0))})),a.data("plugin-initialized",!0))}.bind(this))}.bind(this))},_onPluginRefreshEvent:function(){this.refresh()},_initPluginRefreshEvents:function(){var t,e;if(this._options.refreshEvents){t=this._options.refreshEvents.length;for(var i=0;t>i;i++)e=options.refreshEvents[i],e.filter?this._$el.on(e.eventName,e.filter,this._onPluginRefreshEvent.bind(this)):this._$el.on(e.eventName,this._onPluginRefreshEvent.bind(this))}},_init:function(){this._syncQueryState(),this._onTableLoaded(),this._$el.on("pjax:timeout",this._onPjaxTimeout.bind(this)),this._$el.on("pjax:success",this._onPjaxSuccess.bind(this)),this._$el.on("pjax:start",this._onPjaxStart.bind(this)),this._$el.on("pjax:beforeReplace",this._onPjaxBeforeReplace.bind(this)),this._$el.on("pjax:error",this._onPjaxError.bind(this)),this._$el.on("click",'th[data-sortable="true"]',this._onClickSortable.bind(this)),this._$el.on("click",".ui-perpage-dropdown > li",this._onPerPageSelect.bind(this)),this._$el.on("click",".ui-page-select-dropdown > li",this._onPageSelect.bind(this)),this._$el.on("click",".ui-prev-page",this._onPrevPageSelect.bind(this)),this._$el.on("click",".ui-next-page",this._onNextPageSelect.bind(this)),this._$el.on("change",'th[data-select-all-enabled="true"] input[type="checkbox"]',this._onRowCheckboxSelect.bind(this)),this._$el.on("click",'td[data-property="id"]',this._onClickIdColumn.bind(this)),this._$el.on("change",'input[type="checkbox"]',this._onRowCheckboxChange.bind(this)),this._$searchBox&&(this._$searchBox.on("search:submit",this._onSubmitSearch.bind(this)),this._$searchBox.on("search:clear",this._onClearSearch.bind(this))),this.refreshPlugins(),this._initPluginRefreshEvents()},_getRecord:function(e){var i={additionalFields:{}};return t(e).children().each(function(){var e=t(this),a=e.data();i[a.property]=a.value,t.each(e.data(),function(t,e){"property"!==t&&"value"!==t&&"function"!=typeof e&&"object"!=typeof e&&(i.additionalFields[t]=e)})}),i},_findRowById:function(t){return this._$tbody.find("tr").filter(function(){return this._getRecord(this).id===t?!0:!1}.bind(this)).get(0)},_updateRowFields:function(e,i,a){var s=t(e);t.each(i,function(t,e){var i=s.find('td[data-property="'+t+'"]');i.data(t,e),i.find(i.data("display-target")).text(e),"function"==typeof a&&a(i,t,e)})},refreshPlugins:function(){this._options.plugins&&this._applyPlugins(this._options.plugins)},update:function(t){return this.updateParameters(t),this._load(),this},refresh:function(){return this._load(),this},getUrl:function(){return this._url},updateParameters:function(t){for(var e in t)"undefined"==typeof t[e]||null===t[e]?delete this._queryState[e]:this._queryState[e]=t[e];return this},removeParameters:function(e){if(!e)return this;if("string"==typeof e)delete this._queryState[e];else if(Array.isArray(e))for(var i=0;i<e.length;i++)delete this._queryState[e[i]];else{if("function"!=typeof e)throw new Error("Must provide a string or array");t.each(this._queryState,function(t,i){e(t,i)&&delete this._queryState[t]}.bind(this))}return this},getParameters:function(e){var i=t.extend({},this._queryState);return"function"==typeof e&&t.each(i,function(t,a){e(t,a)||delete i[t]}),i},getNumRecords:function(){return this._$tbody.find("tr").length},getNumColumns:function(){return this._$el.find("thead tr").children().length},hasSelected:function(){return this._$tbody.find("tr.ui-selected").length>0},getNumSelected:function(){return this._$tbody.find("tr.ui-selected").length},getSelected:function(t){return this._$tbody.find("tr.ui-selected").map(function(){return"function"==typeof t?t(this._getRecord(this)):this._getRecord(this)}.bind(this)).get()},getSelectedIds:function(){return this.getSelected().map(function(t){return t.id})},getAllRecords:function(){return this._$tbody.find("tr").map(function(){return this._getRecord(this)}.bind(this)).get()},updateRow:function(t,e,i){this._updateRowFields(this._findRowById(t),e,i)},getTotalRows:function(){return this._totalRows}}),t.fn.pjaxTable=function(e){var s=a.call(arguments),n=["update","refresh","refreshPlugins","getUrl","updateParameters","removeParameters","getParameters","getNumRecords","getNumColumns","hasSelected","getNumSelected","getSelected","getSelectedIds","getAllRecords","updateRow","getTotalRows"],r=[];return t(this).each(function(){var a,o=t(this),h=o.data("pjaxTable");if(h||(h=o.data("pjaxTable",new i(this,e)).data("pjaxTable")),"string"==typeof e&&h)if("destroy"===e)"function"==typeof h.destroy&&h.destroy(),delete o.data()[finalName],o=null;else{if(-1===indexOf(e,n))throw new Error("Invalid method: "+e);a=h[e].apply(this,s.slice(1,s.length)),r.push(a)}else r.push(h)}),r.length>1?r:1===r.length?r[0]:void 0},t(function(){t("[data-pjax-table][data-auto-init]").pjaxTable({})})}(jQuery,window),function(t){"use strict";function e(){this._$el=t(this),this._$searchFilter=$el.find('input[type="search"]'),this._init()}var i=Array.prototype.slice;e.prototype._init=function(){this._$el.find(".ui-search").click(this._onClickSearch.bind(this)),this._$el.find(".ui-close").click(this._onClickClose.bind(this)),this._$searchFilter.keydown(this._onInputKeydown.bind(this))},e.prototype._onClickSearch=function(){this._$el.trigger("search:submit",$searchFilter.val())},e.prototype._onInputKeydown=function(e){e.preventDefault(),this._$el.find(".ui-close").removeClass("hidden"),13===e.which?this._$el.trigger("search:submit",t(e.currentTarget).val()):27==e.which&&this._clearSearch()},e.prototype._onClickClose=function(){this._clearSearch()},e.prototype._clearSearch=function(){this._$searchFilter.val(""),this._$el.trigger("search:clear"),this._$el.find(".ui-close").addClass("hidden")},t.fn.pjaxTableSearch=function(a){var s=(i.call(arguments),[]);return t(this).each(function(){var i=t(this),n=i.data("pjaxTableSearch");n||(n=i.data("pjaxTableSearch",new e(this,a)).data("pjaxTableSearch")),"string"==typeof a&&n?"destroy"===a&&("function"==typeof n.destroy&&n.destroy(),delete i.data()[finalName],i=null):s.push(n)}),s.length>1?s:1===s.length?s[0]:void 0},t(function(){t("[data-pjax-table-search][data-auto-init]").pjaxTableSearch({})})}(jQuery);